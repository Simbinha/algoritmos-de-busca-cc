<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problema de Busca - Algoritmos de Grafos</title>
    <style>
        /* Your existing CSS remains unchanged */
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .image-container {
            text-align: center;
            margin: 20px 0 30px;
        }
        
        .image-container img {
            max-width: 100%;
            height: auto;
        }
        
        .form-container {
            background-color: #f4f4f4;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .button-group {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #result-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            background-color: #f9f9f9;
        }
        
        #path, #cost {
            margin: 10px 0;
        }
        
        #path {
            font-weight: bold;
        }
        
        .hidden {
            display: none;
        }
        
        .param-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #e9e9e9;
            border-radius: 4px;
            display: none;
        }
        
        #loading {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Problema de Busca - Mapa da Romênia</h1>
    
    <div class="image-container">
         <img src="/image.jpg" alt="Mapa das cidades da Romênia com distâncias">
    </div>
    
    <div class="form-container">
        <div class="form-group">
            <label for="start">Cidade de Partida:</label>
            <select id="start">
                <option value="">Selecione uma cidade</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="end">Cidade de Destino:</label>
            <select id="end">
                <option value="">Selecione uma cidade</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="algorithm">Algoritmo:</label>
            <select id="algorithm">
                <option value="">Selecione um algoritmo</option>
                <option value="bfs">BFS - Busca em Largura</option>
                <option value="dfs">DFS - Busca em Profundidade</option>
                <option value="ucs">UCS - Busca de Custo Uniforme</option>
                <option value="dls">DLS - Busca em Profundidade Limitada</option>
                <option value="iddfs">IDDFS - Busca de Aprofundamento Iterativo</option>
                <option value="greedy">Greedy - Busca Gulosa</option>
                <option value="astar">A* - A-Star</option>
            </select>
        </div>
        
        <div id="dls-params" class="param-container">
            <label for="depth-limit">Limite de Profundidade:</label>
            <input type="number" id="depth-limit" min="1" value="3">
        </div>
        
        <div id="iddfs-params" class="param-container">
            <label for="max-depth">Profundidade Máxima:</label>
            <input type="number" id="max-depth" min="1" value="10">
        </div>
        
        <div class="button-group">
            <button id="search-btn">Buscar Caminho</button>
            <button id="clear-btn">Limpar</button>
        </div>
    </div>
    
    <div id="loading">
        Calculando caminho... <br>
        <div style="margin-top: 10px;">
            <div style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-radius: 50%; border-top: 5px solid #4CAF50; animation: spin 2s linear infinite; margin: 0 auto;"></div>
        </div>
    </div>
    
    <div id="result-container" class="hidden">
        <h3>Resultado:</h3>
        <div id="path">Caminho encontrado: </div>
        <div id="cost">Custo total: </div>
        <div id="details"></div>
    </div>
    
    <script>
        // Grafo das cidades e distâncias
        const graph = {
            'Arad': {'Zerind': 75, 'Sibiu': 140, 'Timisoara': 118},
            'Zerind': {'Arad': 75, 'Oradea': 71},
            'Oradea': {'Zerind': 71, 'Sibiu': 151},
            'Sibiu': {'Arad': 140, 'Oradea': 151, 'Fagaras': 99, 'RimnicuVilcea': 80},
            'Timisoara': {'Arad': 118, 'Lugoj': 111},
            'Lugoj': {'Timisoara': 111, 'Mehadia': 70},
            'Mehadia': {'Lugoj': 70, 'Drobeta': 75},
            'Drobeta': {'Mehadia': 75, 'Craiova': 120},
            'Craiova': {'Drobeta': 120, 'RimnicuVilcea': 146, 'Pitesti': 138},
            'RimnicuVilcea': {'Sibiu': 80, 'Craiova': 146, 'Pitesti': 97},
            'Fagaras': {'Sibiu': 99, 'Bucharest': 211},
            'Pitesti': {'RimnicuVilcea': 97, 'Craiova': 138, 'Bucharest': 101},
            'Bucharest': {'Fagaras': 211, 'Pitesti': 101, 'Giurgiu': 90, 'Urziceni': 85},
            'Giurgiu': {'Bucharest': 90},
            'Urziceni': {'Bucharest': 85, 'Hirsova': 98, 'Vaslui': 142},
            'Hirsova': {'Urziceni': 98, 'Eforie': 86},
            'Eforie': {'Hirsova': 86},
            'Vaslui': {'Urziceni': 142, 'Iasi': 92},
            'Iasi': {'Vaslui': 92, 'Neamt': 87},
            'Neamt': {'Iasi': 87}
        };
        
        // Algorithmn descriptions
        const algorithmDescriptions = {
            'bfs': "Busca em Largura (BFS): Explora todos os vizinhos do nó atual antes de avançar.",
            'dfs': "Busca em Profundidade (DFS): Explora o caminho até o máximo possível antes de voltar.",
            'ucs': "Busca de Custo Uniforme (UCS): Explora os caminhos por ordem de custo crescente.",
            'dls': "Busca em Profundidade Limitada (DLS): DFS com limite de profundidade.",
            'iddfs': "Busca de Aprofundamento Iterativo (IDDFS): Executa DLS com profundidade crescente.",
            'greedy': "Busca Gulosa (Greedy): Escolhe sempre o nó mais próximo do objetivo com base na heurística.",
            'astar': "A* (A-Star): Combina custo real do caminho com heurística para encontrar o caminho ótimo."
        };
        
        // Preencher os dropdowns de cidades
        function populateCityDropdowns() {
            const cities = Object.keys(graph).sort();
            const startSelect = document.getElementById('start');
            const endSelect = document.getElementById('end');
            
            startSelect.innerHTML = '<option value="">Selecione uma cidade</option>';
            endSelect.innerHTML = '<option value="">Selecione uma cidade</option>';
            
            cities.forEach(city => {
                startSelect.innerHTML += `<option value="${city}">${city}</option>`;
                endSelect.innerHTML += `<option value="${city}">${city}</option>`;
            });
            
            // Valores padrão
            startSelect.value = 'Arad';
            endSelect.value = 'Bucharest';
        }
        
        // Mostrar parâmetros adicionais com base no algoritmo selecionado
        document.getElementById('algorithm').addEventListener('change', function() {
            const algorithm = this.value;
            const dlsParams = document.getElementById('dls-params');
            const iddfsParams = document.getElementById('iddfs-params');
            
            dlsParams.style.display = algorithm === 'dls' ? 'block' : 'none';
            iddfsParams.style.display = algorithm === 'iddfs' ? 'block' : 'none';
        });
        
        // Funções de validação
        function validateInput(start, end) {
            if (!graph[start] || !graph[end]) {
                alert("Cidade de partida ou chegada inválida. Verifique os nomes.");
                return false;
            }
            return true;
        }
        
        // Executar busca usando a API Flask
        document.getElementById('search-btn').addEventListener('click', function() {
            const start = document.getElementById('start').value;
            const end = document.getElementById('end').value;
            const algorithm = document.getElementById('algorithm').value;
            const resultContainer = document.getElementById('result-container');
            const pathEl = document.getElementById('path');
            const costEl = document.getElementById('cost');
            const detailsEl = document.getElementById('details');
            const loadingEl = document.getElementById('loading');
            
            if (!start || !end || !algorithm) {
                alert('Por favor, selecione a cidade de partida, destino e um algoritmo');
                return;
            }
            
            if (!validateInput(start, end)) {
                return;
            }
            
            // Preparar dados para enviar
            const data = { start, end, algorithm };
            
            if (algorithm === 'dls') {
                data.limit = parseInt(document.getElementById('depth-limit').value) || 3;
            } else if (algorithm === 'iddfs') {
                data.maxDepth = parseInt(document.getElementById('max-depth').value) || 10;
            }
            
            // Mostrar indicador de carregamento
            loadingEl.style.display = 'block';
            resultContainer.classList.add('hidden');
            
            // Chamar a API
            fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.error || 'Nenhum caminho encontrado');
                    });
                }
                return response.json();
            })
            .then(result => {
                // Exibir resultado
                pathEl.textContent = "Caminho encontrado: " + result.path.join(' → ');
                costEl.textContent = `Custo total: ${result.cost} km`;
                detailsEl.textContent = algorithmDescriptions[algorithm];
                if (algorithm === 'dls') {
                    detailsEl.textContent += ` Limite: ${data.limit}.`;
                } else if (algorithm === 'iddfs') {
                    detailsEl.textContent += ` Profundidade máxima: ${data.maxDepth}.`;
                }
                
                resultContainer.classList.remove('hidden');
            })
            .catch(error => {
                pathEl.textContent = error.message;
                costEl.textContent = "";
                resultContainer.classList.remove('hidden');
            })
            .finally(() => {
                // Esconder indicador de carregamento
                loadingEl.style.display = 'none';
            });
        });
        
        // Limpar resultados
        document.getElementById('clear-btn').addEventListener('click', function() {
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('algorithm').value = '';
            document.getElementById('dls-params').style.display = 'none';
            document.getElementById('iddfs-params').style.display = 'none';
        });
        
        // Inicializar a página
        document.addEventListener('DOMContentLoaded', function() {
            populateCityDropdowns();
        });
    </script>
</body>
</html>
